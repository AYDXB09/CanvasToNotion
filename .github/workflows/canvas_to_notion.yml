def filter_assignments_by_due_date(assignments):
    """
    Filters assignments based on optional repository variables:
      DUE_DATE_PERIOD_START (YYYY-MM-DD)
      DUE_DATE_PERIOD_END   (YYYY-MM-DD)
    """

    start_str = os.environ.get("DUE_DATE_PERIOD_START", "").strip()
    end_str = os.environ.get("DUE_DATE_PERIOD_END", "").strip()

    if not start_str and not end_str:
        print("ğŸ“… No due-date filters applied.")
        return assignments

    start_date = None
    end_date = None

    if start_str:
        try:
            start_date = datetime.fromisoformat(start_str).date()
        except:
            print(f"âš ï¸ Invalid DUE_DATE_PERIOD_START: {start_str}")

    if end_str:
        try:
            end_date = datetime.fromisoformat(end_str).date()
        except:
            print(f"âš ï¸ Invalid DUE_DATE_PERIOD_END: {end_str}")

    filtered = []

    for cid, assignment in assignments:
        due_at = assignment.get("due_at")

        if not due_at:
            continue  # skip assignments with no due date

        try:
            due_date = datetime.fromisoformat(due_at.replace("Z", "+00:00")).date()
        except:
            continue

        # CASE 1 â€” Both start and end
        if start_date and end_date:
            if start_date <= due_date <= end_date:
                filtered.append((cid, assignment))
            continue

        # CASE 2 â€” Only end
        if end_date:
            if due_date <= end_date:
                filtered.append((cid, assignment))
            continue

        # CASE 3 â€” Only start
        if start_date:
            if due_date >= start_date:
                filtered.append((cid, assignment))
            continue

    print(f"ğŸ“… Due-date filter reduced assignments from {len(assignments)} â†’ {len(filtered)}")
    return filtered
